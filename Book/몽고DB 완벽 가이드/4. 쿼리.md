쿼리에서 주로 다루는 영역은 다음과 같다.
- `$` 조건절을 이용해 범위 쿼리, 셋의 포함관계, 부등 관계 쿼리 등을 수행한다.
- 쿼리는 필요할 때마다 도큐먼트 배치(batch)를 반환하는 데이터베이스 커서(database cursor)를 반환한다.
- 커서(cursor)를 이용해 결과를 몇 개 건너뛰거나, 반환하는 결과 수를 제한하거나, 결과를 정렬하는 등 다양한 메타연산(metaoperation)을 수행한다.

# find 소개
- mongDB 에서 `find` 함수는 쿼리에 사용한다. 쿼리는 컬렉션에서 도큐먼트의 서브셋(빈 컬렉션부터 컬렉션 전체까지)을 반환한다. `find`의 첫 매개변수에 따라 어떤 도큐먼트를 가져올지 결정된다. 
- 빈 쿼리 도큐먼트 (`{}`) 는 컬렉션 내 모든 것과 일치한다. 매개변수에 쿼리 도큐먼트가 없으면 `find` 함수는 빈 쿼리 도큐먼트 `{}` 로 인식한다. 따라서 다음 명령은 컬렉션 `c`의 모든 도큐먼트와 일치하므로 컬렉션 `c` 내 모든 도큐먼트를 반환한다.
```
> db.c.find()
```
- 쿼리 도큐먼트에 여러 키/값 쌍을 추가해 검색을 제한할 수 있다. 대부분의 데이터형에서 간단히 작동하며 정수형은 정수형에, 불리언형은 불리언형에, 문자열형은 문자열형에 일치한다. 간단한  데이터형은 찾으려는 값만 지정하면 쉽게 쿼리할 수 있다.
```
> db.users.find({"age" : 29})
> db.users.find({"name" : "hajong"})
```
- 쿼리 도큐먼트에 여러 개의 키/값 쌍을 추가할 수 있으며 `AND` 연산으로 해석된다.
```
> db.users.find({"age" : 29, "name" : "hajong"})
```

## 반환받을 키 지정
- 때때로 반환받은 도큐먼트 내 키/값 정보가 모두 필요하지는 않을 수 있다. 그럴 땐 두 번째 매개변수에 원하는 키를 지정하면 된다. 이는 네트워크상의 데이터 전송량과 클라이언트 측에서 도큐먼트를 디코딩하는데 드는 시간과 메모리를 줄여준다.
```
> db.users.find({}, {"username": 1, "email": 1})
```
- `_id` 키는 지정하지 않아도 항상 반환된다.
- 특정 키/값을 제외한 결과를 얻을 수도 있다. 특정 키가 필요하지 않은 경우 해당 필드의 값을 0으로 지정해주면 된다. 이것으로 `_id` 를 제외할 수도 있다.
```
> db.users.find({}, {"username": 1, "_id": 0})
```

## 제약 사항
- 쿼리에는 몇 가지 제약이 있다. 데이터베이스에서 쿼리 도큐먼트 값은 반드시 상수여야 한다. 이는 도큐먼트 내 다른 키의 값을 참조할 수 없음을 의미한다. 
- 예를 들어 재고 도큐먼트에 재고 수량 키 `"in_stock"` 과 판매 수량 키 `"num_sold"` 가 있으면 키 값을 다음과 같은 쿼리로 비교할 수 없다.
```
> db.stock.find({"in_stock" : "this.num_sold"})
```
- 다른 쿼리 방법이 있지만 (4.4 `$where` 쿼리 참조) 일반 쿼리로 처리할 수 있게 도큐먼트 구조를 약간 재구성하면 더 나은 성능을 얻을수 있다. `"initial_stock"` 과 `"in_stock"` 키를 사용하여 누군가가 상품을 구매할 때마다 `"in_stock"` 값을 감소시키면 품절 상품을 확인하는 쿼리는 다음과 같다.
```
> db.stock.find({"in_stock" : 0})
```