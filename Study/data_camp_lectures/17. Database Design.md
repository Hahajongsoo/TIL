 고성능의 어플리케이션에 있어서 좋은 데이터베이스 디자인은 필수적이다. 청사진 없이 집 짓기를 시작할 수 없는 것 처럼 데이터가 어떻게 저장될지 미리 생각해두어야 한다. 데이터베이스를 설계할 시간을 가지는 것은 나중에 소요될 시간과 좌절을 줄여준다. 그리고 잘 디자인된 데이터베이스는 정보에대한 접근과 탐색을 쉽게 해준다. 디자인을 선택할 때, 다양한 고려사항들을 생각해야 한다. 이 과정에서는 어떻게 효과적인 방법으로 데이터를 처리하고 저장하고 정리하는 지를 배운다. 정규화를 통해 데이터를 세우고 뷰를 통해 데이터를 나타내는지를 배운다. 마지막으로 데이터베이스를 관리하는 법을 배운다.

# Processing, Storing, and Organizing Data
데이터를 어떻게 구성하고 관리해야 할까? 이에 대한 답을 얻으려면 다양한 스키마, 관리 옵션 그리고 데이터베이스를 구성하는 개체들을 고려해야한다. 아래 주제들은 모두 데이터가 저장되고 접근되는 방식에 영향을 미친다. 일부는 쿼리 속도를 더 빠르게하고, 일부는 메모리를 덜  차지하게 한다. 일부는 다른 것 보다 더 많은 비용이 든다.
- Schemas: *How should my data be logically organized?*
- Normalization: *Should my data have minimal dependency and redundancy?*
- Views: *What joins will be done most often?*
- Access control: *Should all users of the data have the same level of access?*
- DBMS: *How do i pick between all the SQL and noSQL options?*
- and more

## OLTP and OLAP
데이터 처리에 대한 접근 방식이다. 데이터의 흐름, 구조, 저장방식을 정의하는데 도움을 준다. 비즈니스 사례에 맞는 방식을 파악하면 데이터베이스를 설계하는 것이 더 쉬워진다. 

| OLTP(Online Transaction Processing) | OLAP(Online Analytical Processing) |
| ----------------------------------- | ---------------------------------- |
| 트랜잭션 중심                       | 분석 중심                          |
| 책의 가격 찾기                      | 가장 수익성이 좋은 책 분석하기     |
| 최근 고객 거래 업데이트             | 우수 고객 찾기                     |
| 직원 근무시간                       | 이달의 우수사원 선정               |
OLTP는 일상 업무를 도와주는데 집중하고 OLAP가 사용되는 업무는 모호하고 업무 의사 결정을 하는데 도움을 준다.

|         | OLTP                                   | OLAP                                         |
| ------- | -------------------------------------- | -------------------------------------------- |
| Purpose | support daily transactions             | report and analyze data                      |
| Design  | application-oriented                   | subject-oriented                             |
| Data    | up-to-date, operational                | consolidated, historical                     |
| Size    | snapshot, gigabytes                    | archive, terabytes                           |
| Queries | simple transactions & frequent updates | complex, aggregate queries & limited updates |
| Users   | thousands                              | hundreds                                     | 

![](images/Pasted%20image%2020221207231952.png)
OLAP와 OLTP 시스템은 함께 작동한다. OLTP 데이터는 보통 Operational database에 저장되고 이는 OLAP 데이터 웨어하우스를 만들기 위해서 사용된다. 
예를 들어 거래 데이터가 없다면 분석을 수행할 수 없다. OLAP 시스템에서의 분석은 업무 사례와 일일 활동을 알려주기 때문에 OLTP 데이터베이스에 영향을 미친다.
## Storing data
데이터는 세 가지 수준으로 저장될 수 있다.  
1. Structured data
	- 스키마에 의해 정의된다.
	- 데이터 타입과 테이블이 정의 되고, 그 관계 또한 정의된다. 
	- SQL, 관계형 데이터 베이스의 테이블 등
2. Unstructured data
	- 스키마가 없는 raw 형태의 데이터
	- 대부분의 데이터는 비정형 데이터이다.
	- 사진, MP3, 채팅로그 등
3. Semi-structured data
	- 큰 스키마를 따르지 않고 자기기술적(self describing)이다.
	- 정형 데이터와 비정형 데이터 사이에 다양한 변형이 있을 수 있기 때문에 모호한 정의이다.
	- NoSQL, XML, JSON 등

### Structuring data
![](images/Pasted%20image%2020221208115140.png)
정형데이터는 정돈되어 있기 때문에 분석하기 편하다. 하지만 스키마를 따라야하기 때문에 덜 가변적이다. 즉 분석에 용이함과 데이터의 유연성, 가변성 사이에는 트레이트 오프가 존재하고 이에 따라 어떤 수준의 데이터를 사용할 지 정해야한다. 


### Storing data beyond traditional database
- Traditional databases
	- 기존 데이터베이스에 이미 익숙해야한다. 이는 일반적으로 관계형 스키마를 따른다.  OLTP
- Data warehouses
	- 데이터 분석이 시작되면서 OLAP 접근을 위해 데이터 웨어하우스가 대중화되었다. 
- Data lakes
	- 빅데이터 시대가 오면서 더 많은 데이터를 저장하고 분석해야한다.
	- 모든 형태의 데이터를 저장할 수 있고 이러한 데이터를 분석하기 위함이다.

### Data warehouses
- 분석에 최적화 되어있다.OLAP
	- 데이터를 읽고 집계하기 위해 정리되어 있다.
	- 보통 읽기 전용이다.
- 다양한 소스에서 데이터를 가져와 결합한다. 
- 빠른 쿼리를 위해서 병렬 처리를 수행한다. (Massively Parallel Processing)
- denormalized schema 와 dimensional modeling을 사용한다.
- amazon REDSHIFT, Azure SQL Data Warehouse, Google BIgQuery 등 솔루션들 ㅣ있다.

#### Data mart
- 특정 주제에 대한 데이터 웨어하우스의 subset이다.
- 특정 부서가 해당 부서에 관련한 데이터에 쉽게 접근할 수 있도록 한다. 
![300](images/Pasted%20image%2020221208133008.png)
### Data lakes
기존의 데이터베이스와 웨어하우스는 비정형 데이터를 저장할 수 있지만 비용면에서 비효율적이다. 데이터레이크는 기존의 block 또는 file stroage와 다르게 object storage를 사용하기 때문에 더 저렴하다. 
- 모든 타입의 데이터를 더 싸게 저장할 수 있다. 실시간 데이터에서 기존 데이터 베이스 까지
- 모든 데이터를 저장할 수 있기 때문에 페타바이트 까지 이를 수 있다. 
- schema-on-read 방식을 사용하며 이는 데이터를 읽을 때, 스키마가 적용되는 것을 의미한다. 즉 데이터가 저장될 때는 스키마 없이 그대로 저장되고 나서 읽을 때 특정 스키마로 읽게 되는 것이다.
	- 데이터웨어하우스나 기존의 데이터베이스는 schema-on-write로 분류하고 이는 스키마가 사전에 정의되어 있어 해당 형태로만 데이터가 저장됨을 의미한다.
- 데이터레이크가 잘 조직되고 분류되지 않고 유지관리 되지 않는다면 data swamp가 된다.
- 데이터를 저장하는것에서 그치지 않고 데이터 레이크 상에서 분석을 하기 시작했다. Spark 와 Hadoop등의 서비스를 이용하여 분석을 한다.

### ETL, ELT
데이터를 저장할 때, 데이터를 어떤 형식으로 어떻게 저장할 지 생각해야 한다. ETL과 ELT는 해당 흐름을 설명하는 두 가지 다른 접근 방식이다. ETL은 데이터웨어하우스와 소규모 분석에 사용되는 좀 더 전통적인 방식이며 ELT는 빅데이터 프로젝트에 사용되는 방식이다.
- ETL
![](images/Pasted%20image%2020221208135538.png)
- ELT
![](images/Pasted%20image%2020221208135555.png)

## Database design
- 데이터베이스 디자인은 데이터가 어떻게 논리적으로 저장될지를 결정한다. 이는 데이터를 읽거나 업데이트 할 때, 데이터베이스가 쿼리되는 방식에 영향을 주기 때문에 중요하다. 
- 데이터베이스 모델과 스키마는 데이터베이스 디자인에서 중요한 두 가지 개념이다.
	- 데이터베이스 모델: 데이터베이스 구조에 대한 고수준의 사양, 명세이다.
		- 가장 흔히 사용되는 것은 RDB를 만들때 사용되는 관계형 모델이다. 행을 record로 열을 attribute로 정의한다. 각 행에 고유 키가 있는 것과 같은 규칙이 필요하다.
		- 위의 규칙을 적용하지 않는 다른 모델들이 있다. NoSQL models, object-oriented model, network model 등
	- 스키마: 데이터베이스의 청사진 즉, 데이터베이스 모델의 구현이다. 
		- 특정 테이블, 필드, 관계, 인덱스와 뷰를 정의하여 논리적 구조를 더 세분화 한다. 
		- 관계형 데이터베이스에 정형 데이터를 넣을 때 스키마를 준수해야 한다.

### Data modeling
데이터베이스 디자인의 첫 단계는 데이터 모델링이다. 저장할 데이터에 대한 데이터 모델을 만드는 추상적인 디자인 단계이다. 
1. 개념적 데이터 모델(Conceptual data model): 엔티티, 관계, 속성등 데이터베이스가 포함하고 있는 것을 설명한다.
	- ER(Entity Relationship) 다이어그램과 UML(Unified Modeling Language) 다이어그램 등의 데이터 구조 다이어그램을 사용한다.
2. 논리적 데이터 모델(Logical data model): 엔티티와 관계가 테이블에 매핑되는 방식을 정의한다.
	- 관계형 모델과 스타 스키마 등의 데이터베이스 모델과 스키마를 사용한다.
3. 물리적 데이터 모델(Pyhsical data model): 데이터가 물리적으로 저장되는 방식을 기술한다.
	- 파티션, CPU, 인덱스, 백업시스템, 테이블스페이스 등이 사용된다.
이 세 단계의 데이터 모델은 데이터의 일관성을 보장하고 구현과 사용에 대한 계획을 제공한다.

#### ER 다이어그램 과 스키마 예시
![](images/Pasted%20image%2020221208143705.png)
- ER 다이어그램에서 빨간 동그라미는 속성을 나타내고 직사각형은 엔티티를 의미한다. 마름모는 관계를 나타낸다.
- 스키마를 만드는 가장 빠른 방법은 엔티티를 테이블로 변환하는 것이다. 하지만 노래 정보를 얻을 때 마다 조인을 실행하고 싶지 않으면 하나의 테이블로 나타낼 수도 있다. 또는 장르와 레이블에 대한 테이블을 추가하여 해당 속성을 공유한다면 데이터 무결성에 도움이 될 수도 있다. 즉 테이블을 어떻게 정의하느냐에 따라 다르다.

### Dimensional modeling
데이터 웨어하우스 디자인에 관계형 모델을 적용한 것이다. 
- 데이터를 업데이트하는 것이 아니라 집계하고 분석하는 것을 목표로 하는 OLAP 유형의 쿼리에 최적화 되어 있다. 
- 이를 위해서 스타 스키마를 사용한다.
- dimensional model 의 스키마는 해석하기 쉽고 확장하기 쉽다.

#### Elements of dimensional modeling
차원 모델은 fact table과 dimension table의 두 가지 유형의 테이블로 구성된다.
![](images/Pasted%20image%2020221208144658.png)
- Fact tables
	- 비즈니스의 use-case에 따라서 결정된다.
	- 주요 메트릭에 대한 레코드가 포함되며 해당 메트릭은 자주 변경된다.
	- dimension table에 대한 외래키를 포함한다.
- Dimension tables
	- 특정 속성에 대한 설명을 포함한다.
	- 자주 변경되지 않는다.

위에 예시를 보면 fact table은 dimension table에 대한 외래키를 포함하고 dimension table은 fact table의 속성을 확장한다. fact table은 새로운 노래가 추가 될 때 마다 바뀌므로 자주 바뀐다. dimension table의 내용들은 다양한 노래에 대해서 공유되므로 자주 바뀌지 않는다. dimension model 에서 fact table을 결정하기 위해서 무엇이 분석되고 엔티티가 얼마나 자주 변하는지 고려해야 한다.
# Database Schemas and Normalization

# Database Views

# Database Management