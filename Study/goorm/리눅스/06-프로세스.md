# 프로세스의 개념
- 프로세스: 현재 시스템에서 실행중인 프로그램

## 프로세스의 부모-자식 관계
- 프로세스는 부모-자식 관계를 가지고 있음
- 필요에 따라 부모 프로세스는 자식 프로세스를 생성하고, 자식 프로세스는 또 다른 자식 프로세스 생성 가능
- 부팅할 때 스케줄러가 실행한 프로셋스인 `systemd`와 `kthreadd` 프로세스를 제외하면 모든 프로세스는 부모프로세스를 가지고 있음
	- 사용자 프로그램들은 `systemd`가 가장 상위 프로세스이고 커널 프로세스들은 `kthreadd`가 가장 상위 프로세스이다. 
	- 예를들어, 부모 프로세스인 배시 셸에서 자식 프로세스인 `vi`, `ls` 등을 실행한다.
- 자식 프로세스는 할 일이 끝나면 부모 프로세스에 결과를 돌려주고 종료된다.
```
[root@localhost ~]#vi

systemd─┬─ModemManager───2*[{ModemManager}]
        ├─NetworkManager─┬─2*[dhclient]
        │                └─2*[{NetworkManager}]
        ├─3*[VBoxClient───VBoxClient───2*[{VBoxClient}]]
		...
        ├─sshd───sshd───bash───vi───pstree
		...
```

## 프로세스의 번호(PID)
- 각 프로세스는 고유한 번호를 가지고 있다.

## 프로세스의 종류
- 데몬 프로세스
	- 특정 서비스를 제공하기 위해 존재하며 리눅스 커널에 의해 실행
- 고아 프로세스
	- 자식 프로세스가 아직 실행 중인데 부모 프로세스가 먼저 종료된 자식 프로세스는 고아(orphan) 프로세스라고 한다.
	- 1번 프로세스가 고아 프로세스의 새로운 부모 프로세스가 되어 고아 프로세스의 작업 종료 지원
- 좀비 프로세스
	- 자식 프로세스가 실행을 종료했는데도 프로세스 테이블 목록에 남아있는 경우
	- 좀비 프로세스는 프로세스 목록에 `defunct` 프로세스라고 나오기도 함
	- 좀비 프로세스가 증가하면 프로세스 테이블의 용량이 부족해서 일반 프로세스가 실행되지 않을 수도 있음
		- `top` 명령을 사용해서 좀비 프로세스 개수 확인 가능

# 프로세스 관리 명령

## 프로세스 목록 보기: `ps`
- 유닉스(SVR4) 옵션: 묶어서 사용할 수 있고 `-`로 시작한다.
- BSD 옵션: 묶어서 사용할 수 있고, `-`로 시작하지 않는다.
- GNU 옵션: `--`로 시작한다.
- 기능: 현재 실행 중인 프로세스의 정보를 출력한다.
- 형식 : `ps [옵션]`
- 옵션
	- `-e`: 시스템에서 실행 중인 모든 프로세스의 정보를 출력한다.
	- `-f`: 프로세스의 자세한 정보를 출력한다.
	- `-u uid` : 특정 사용자에 대한 모든 프로세스의 정보를 출력한다.
	- `-p pid`: `pid`로 지정한 특정 프로세스의 정보를 출력한다.
	- `a`: 터미널에서 실행한 프로세스의 정보를 출력한다.
	- `u`: 프로세스의 소유자 이름, CPU 사용량, 메모리 사용량 등 상세 정보를 출력한다.
	- `x`: 시스템에서 실행 중인 모든 프로세스의 정보를 출력한다
	- `--pid PID 목록`: 목록으로 지정한 특정 PID 정보를 출력한다.

### `ps`
- 현재 셸이나 터미널에서 실행한 사용자 프로세스에 대한 정보를 출력한다.
```
[root@localhost ~]#ps
  PID TTY          TIME CMD
10811 pts/1    00:00:00 bash
12156 pts/1    00:00:00 ps
```
- TTY는 터미널을 나타낸다. 
	- `tps/1`은 가상 터미널 1번을 나타낸다. 여러번 접속하게 되면 여러 터미널이 할당된다.
	- `/dev/pts` 에서 기기가 늘어난 것을 확인할 수 있다.
![](images/Pasted%20image%2020221229145135.png)

### `ps -f`
- 프로세스의 상세한 정보를 출력: PPID와 터미널 번호, 시작시간 등
```
[root@localhost ~]#ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
root     13027 13022  0 14:52 pts/0    00:00:00 -bash
root     13145 13027  0 14:53 pts/0    00:00:00 ps -f
```

| 항목   | 의미                        | 항목    | 의미                                   |
| ------ | --------------------------- | ------- | -------------------------------------- |
| `UID`  | 프로세스를 실행한 사용자 ID | `STIME` | 프로세스의 시작 날짜나 시간            |
| `PID`  | 프로세스 번호               | `TTY`   | 프로세스가 실행된 터미널의 종류와 번호 |
| `PPID` | 부모 프로세스 번호          | `TIME`  | 프로세스 실행 시간                     |
| `C`    | CPU 사용량(%)               | `CMD`   | 실행되고 있는 프로그램 이름(명령)                                       |


### `ps au`
- 터미널에서 실행한 프로세스의 상세 정보를 출력
```
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root      4446  0.0  2.9 327376 55928 tty1     Ssl+ Dec27   0:12 /usr/bin/X :0 -background none -noreset -audit 4 
root     13027  0.0  0.1 116328  2908 pts/0    Ss   14:52   0:00 -bash
root     13457  0.0  0.0 155452  1856 pts/0    R+   14:57   0:00 ps au
```

| 항목   | 의미                                 | 항목    | 의미                            |
| ------ | ------------------------------------ | ------- | ------------------------------- |
| `USER` | 사용자 계정 이름                     | `VSZ`   | 사용중인 가상 메모리의 크기(KB) |
| `%CPU` | 퍼센트로 표시한 CPU 사용량           | `RSS`   | 사용중인 물리 메모리의 크기(KB) |
| `%MEM` | 퍼센트로 표시한 물리적 메모리 사용량 | `START` | 프로세스 시작 시간                                |

- `STAT`에 사용되는 문자의 의미

| 문자 | 의미                                  |
| ---- | ------------------------------------- |
| `R`  | 실행 중(running)                      |
| `S`  | 인터럽트가 가능한 대기(sleep) 상태    |
| `T`  | 작업 제어에 의해 정지된(stopped) 상태 |
| `Z`  | 좀비 프로세스(defunct)                |
| `s`  | 세션 리더 프로세스                    |
| `+`  | 포그라운드 프로세스 그룹              |
| `l`  | 멀티스레드                            |

### 전체 프로세스 목록 출력하기: `ps -e`, `ps ax`
- `TTY` 가 `?`인 경우는 대부분 데몬으로 시스템이 실행한 프로세스
```
[root@localhost ~]#ps -e
  PID TTY          TIME CMD
    1 ?        00:00:53 systemd
    2 ?        00:00:00 kthreadd
    4 ?        00:00:00 kworker/0:0H
    6 ?        00:00:03 ksoftirqd/0
    7 ?        00:00:00 migration/0
    8 ?        00:00:00 rcu_bh
    9 ?        00:00:11 rcu_sched
   10 ?        00:00:00 lru-add-drain
   11 ?        00:00:01 watchdog/0
   13 ?        00:00:00 kdevtmpfs
   14 ?        00:00:00 netns
   15 ?        00:00:00 khungtaskd
   16 ?        00:00:00 writeback
...
```

```

```