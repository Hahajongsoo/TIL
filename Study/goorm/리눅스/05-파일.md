# 파일의 속성

## 파일 접근 권한 보호
- 기본적으로 리눅스는 멀티 유저 운영체제이다.
- 리눅스는 파일에 무단으로 접근하는 것을 방지하고 보호하는 기능을 제공
- 사용자는 자신의 파일과 디렉토리 중에서 다른 사용자가 접근해도 되는 것과 그렇지 않은 것을 구분하여 접근 권한을 제한

## 파일의 속성
```
[root@localhost ~]#ls -l /etc/hosts
-rw-r--r--. 1 root root 158 Jun  7  2013 /etc/hosts
```

| 번호 | 속성 값    | 의미                                           |
| ---- | ---------- | ---------------------------------------------- |
| 1    | -          | 파일의 종류                                    |
| 2    | rw-r--r--  | 파일을 읽고 쓰고 실행할 수 있는 접근 권한 표시 |
| 3    | 1          | 하드 링크의 개수                               |
| 4    | root       | 파일 소유자의 로그인 ID                        |
| 5    | root       | 파일 소유자의 그룹 이름                        |
| 6    | 158        | 파일의 크기(바이트 단위)                       |
| 7    | Jun 7 2013 | 파일이 마지막으로 수정된 날짜                  |
| 8    | /etc/hosts | 파일 명                                               |

### 파일의 종류
- 파일 속성의 첫 번째 항목은 파일의 종류를 표시
- `-`는 일반 파일을, `d`는 디렉토리를, `l`은 소프트링크를 의미
- 파일의 종류를 알려주는 명령: `file`

### 파일의 접근 권한 표시
- 파일의 소유자와 그룹이나 기타 사용자들이 파일에 대해 가지고 있는 접근 권한 표시

### 하드 링크의 개수
- 하드 링크는 한 파일에 대해 여러 개의 파일명을 가질 수 있도록 하는 기능

### 파일 소유자의 로그인 ID
- 리눅스에서 모든 파일은 소유자가 있음

### 파일 소유자의 그룹 이름
- 사용자가 속한 기본 그룹은 시스템 관리자가 사용자를 등록할 때 결정
- 사용자가 속한 그룹을 알려주는 명령
	- 주 그룹과 부 그룹을 출력한다.
	- `groups`
	- `id`
```
[root@localhost ~]#groups user
user : user wheel
```

```
[root@localhost ~]#id user
uid=1000(user) gid=1000(user) groups=1000(user),10(wheel)
```

### 접근 권한의 종류
- 읽기, 쓰기, 실행 세 가지 권한으로 구성

| 권한 | 파일                                                                    | 디렉토리                                |
| ---- | ----------------------------------------------------------------------- | --------------------------------------- |
| 읽기 | 파일을 읽거나 복사할 수 있다.                                           | ls 명령으로 디렉터리 목록을 볼 수 있다. |
| 쓰기 | 파일을 수정, 이동, 삭제할 수 있다.(디렉토리에 쓰기 권한이 있어야 한다.) | 파일을 생성하거나 삭제할 수 있다.       |
| 실행 | 파일을 실행할 수 있다.(셸 스크립트나 실행 파일의 경우)                  | cd 명령을 사용할 수 있다. 파일을 디렉토리로 이동하거나 복사할 수 있다.                                        |

#### 접근 권한의 표기 방법
- 사용자 카테고리 별로 누가 파일을 읽고 쓰,고 실행할 수 있는지를 문자로 표현한 것
- 읽기 권한은 r, 쓰기 권한은 w, 실행 권한은 x로 나타내며, 해당 권한이 없는 경우에는 -로 표기
- 사용자 카테고리 별로 세 가지 권한 부여 여부를 rwx 세 문자를 묶어서 표기
	- 소유자, 그룹, 기타 사용자의 순서임

#### 접근 권한의 변경 명령: chmod
- 기능: 파일이나 디렉토리의 접근 권한을 변경한다.
- 형식: `chmod [옵션] [권한 모드] [파일 또는 디렉토리]`
- 옵션
	- `-R`: 하위 디렉토리 까지 모두 변경할 수 있다.
- 기호 모드: 접근 권한을 변경하기 위해 문자와 기호를 사용하여 권한 표시
- 숫자 모드: 접근 권한을 변경하기 위해 숫자를 사용

##### 기호모드
- `chmod [사용자 카테고리 문자 + 연산자 기호 + 접근 권한 문자] [파일명]` 의 형태로 사용

| 구분                 | 의미                                                                                                      |
| -------------------- | --------------------------------------------------------------------------------------------------------- |
| 사용자 카테고리 문자 | - u: 파일소유자 <br>- g: 소유자가 속한 그룹 <br>- o: 소유자와 그룹 이외의 기타 사용자<br>- a: 전체 사용자 |
| 연산자 기호          | - +: 권한 부여<br> - -: 권한 제거<br> - =: 접근 권한 설정                                                 |
| 접근 권한 문자       | - r: 읽기 권한 <br>- w: 쓰기 권한 <br>- x: 실행 권한                                                                                                          |

##### 숫자 모드
- 숫자 모드에서는 각 권한의 위치 (`rwx`) 에 따라 권한이 있고 없음을 0과 1로 표기(2진수)한다. 이를 다시 환산하여 숫자(10진수)로 표현한다.
- 카테고리 별로 권한의 조합에 따라 0 부터 7(2^3 = 8 가지)로 나타내는 것
- 숫자의 각 위치가 사용자 카테고리를 나타내기 때문에 사용자 카테고리를 따로 지정할 필요가 없다.
- 항상 세 자리 수를 사용해야 하므로 변경하려는 사용자 카테고리의 권한뿐만 아니라 기타 사용자의 권한도 반드시 같이 명시

```
[root@localhost test]#ll
total 0
-rw-r--r--. 1 root root 0 Dec 29 10:08 1
-rw-r--r--. 1 root root 0 Dec 29 10:08 2
-rw-r--r--. 1 root root 0 Dec 29 10:08 3
-rw-r--r--. 1 root root 0 Dec 29 10:08 4
-rw-r--r--. 1 root root 0 Dec 29 10:08 5
-rw-r--r--. 1 root root 0 Dec 29 10:08 6
[root@localhost test]#chmod u+x 1 // 파일 소유자에 실행권한 부여
[root@localhost test]#chmod g-r 2 // 소유자가 속한 그룹에 읽기 권한 제거
[root@localhost test]#chmod o=rwx 3 // 이외 사용자에 모든 권한 설정
[root@localhost test]#chmod a-r 4 // 모든 사용자에 읽기 권한 제거
[root@localhost test]#chmod 777 5 // 모든 사용자에 모든 권한 설정
[root@localhost test]#chmod 654 6 // 파일 소유자에 rw, 그룹에 rx, 이외사용자에 r 설정
[root@localhost test]#ll
total 0
-rwxr--r--. 1 root root 0 Dec 29 10:08 1
-rw----r--. 1 root root 0 Dec 29 10:08 2
-rw-r--rwx. 1 root root 0 Dec 29 10:08 3
--w-------. 1 root root 0 Dec 29 10:08 4
-rwxrwxrwx. 1 root root 0 Dec 29 10:08 5
-rw-r-xr--. 1 root root 0 Dec 29 10:08 6
```

# 기본 접근 권한 설정

## 기본 접근 권한
- 리눅스에서 파일이나 디렉토리를 생성할 때 기본 접근권한이 자동적으로 설정
- centos에서 root계정의 경우 파일은 644, 디렉토리는 755로 생성된다.
- 일반 계정의 경우 파일은 664, 디렉토리는 775로 생성된다.

## 기본 접근 권한 확인하고 변경하기: `umask`
- 기능: 기본 접근 권한을 출력하거나 변경한다.
- 형식: `umask [옵션] [마스크 값]`
- 옵션
	- `-S`: 마스크 값을 문자로 출력한다.

리눅스에서 파일은 기본 권한이 666이고 디렉토리는 777이다. 그리고 umask 값을 빼서(비트 클리어) 파일이 생성될 때 기본 접근 권한을 설정하는 것이다. 
```
[root@localhost test]#umask
0022
[root@localhost test]#su user
[user@localhost test]$ umask
0002
```
- root의 경우 666 - 0022 = 644, 777 - 0022 = 755
- user의 경우 666 - 0002 = 664, 777 - 0002 = 775

umask의 경우 보안 때문에 사용한다. 보안이 높아야 하는 경우에는 umask를 크게 잡아 기본으로 설정되는 권한을 낮춘다. umask 077 로 설정해둔다면 파일 소유자를 제외하고 나머지에게는 모든 권한을 주지 않는 것이다.

# 특수 접근 권한
- 접근 권한은 원래 4자리이고 생략된 맨 앞자리는 특수 접근 권한을 의미한다.
- 맨 앞자리 숫자가 0이면 일반적인 접근 권한이지만 1, 2, 4 이면 특수 접근 권한이 설정
	- `SetUID`: 4
	- `SetGID`: 2
	- 스티키 비트(sticky bit): 1
- `chmod`의 기호 모드에서는 `u+s`, `g+s` 등의 형태로 사용하면 되고 숫자 모드에서는 `4755` 의 형태로 4자리로 설정하면 된다.

## `SetUID`
- 해당 파일이 실행되는 동안에는 파일을 실행한 사용자의 권한이 아니라 파일 소유자의 권한으로 실행
- `SetUID`가 설정되면 소유자의 실행 권한에 `s`가 표시

```
[root@localhost test]#ls -l /bin/passwd
-rwsr-xr-x. 1 root root 27856 Apr  1  2020 /bin/passwd
[root@localhost test]#ls -l /bin/su
-rwsr-xr-x. 1 root root 32128 Feb  3  2021 /bin/su
```
- 패스워드를 수정한다는 것은 `/etc/shadow`를 수정하는 것인데, 이 파일은 루트만 수정할 수 있다. `passwd`가 루트 권한으로 실행되기 때문에 패스워드를 수정할 수 있는 것이다.
- `su`의 경우 일반 계정을 루트 계정으로 바꿀 수도 있다. 루트 권한이 없다면 이것이 불가능할 것이고 그래서 `SetUID`를 사용하여 루트 권한으로 실행할 수 있게 하여 루트 로그인이 가능하게 한다.

## `SetGID`
- 해당 파일이 실행되는 동안에는 파일 소유 그룹의 권한으로 실행
- `SetGID`가 설정되면 파일 소유 그룹의 실행 권한에 `s`가 표시

## 스티키 비트
- 스티키 비트는 디렉토리에 설정하고, 설정되어 있다면 이 디렉토리에는 누구나 파일을 생성할 수 있다.
- 파일은 파일을 생성한 계정으로 소유자가 설정되며, 다른 사용자가 생성한 파일은 삭제 불가
- `/tmp` 디렉토리가 대표적이다.
	- 부팅하면 안의 데이터가 삭제된다.
	- 메모리에 생성되는 임시 디렉토리이다.
```
[root@localhost test]#ls -ld /tmp
drwxrwxrwt. 18 root root 4096 Dec 29 12:19 /tmp
```
- 기타 사용자 실행 권한이 `t`로 되어있는 것을 확인할 수 있다.

## 권한 있는 파일 검색하기
- `find / -prem -4000 2>/dev/null` 등으로 검색하면 된다.
