# 로드 밸런싱
- 네트워크 트래픽을 하나 이상의 서버나 장비로 분산하는 기술
- 외부에서 발생하는 많은 인터넷 트래픽을 여러 웹 서버나 장비로 부하를 분산하여 처리할 수 있다.
- 웹 트래픽 증가에 대한 처리 방식은 크게 두 가지
	- Scale Up: 서버의 성능을 높인다.
	- Scale Out: 서버의 개수를 늘린다. 

# 로드 밸런싱 방식
## Round Robin
Real 서버로의 Session 연결을 순차적으로 맺어주는 방식. 연결되어 있는 Session 수에 상관 없이 순차적으로 연결시키는 방식으로 Session에 대한 보장을 제공하지 않는다.
## Hash
Client와 Server 간에 연결된 Session을 계속 유지해주는 방식으로 Client가 특정 server로 연결된 이후 동일 서버로만 연결되는 구조
## Leat Connection
Session 수를 고려하여 가장 적은 Session을 보유한 서버로 Session을 맺어주는 방식, Session에 대 한 보장을 제공하지 않는다. 
## Response Time
서버 간의 Resource와 Connection의 차이가 있는 환경에서 사용되는 방식, 응답시간을 고려하여 빠른 응답시간을 제공하는 서버로 Session을 맺어준다. Session에 대한 보장을 제공하지 않는다.

# Amazon Elastic Load Balancing
- 단일 AZ 또는 여러 AZ에서 EC2 인스턴스 및 컨테이너, IP 주소 같은 동일한 서비스를 제공하기 위해 준비된 여러 대상으로 애플리케이션 및 네트워크 트래픽을 자동으로 분산

| 구분      | 내용                                                                                                                                                                                                                                                                                         |
| --------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 서비스명  | Amazon Elastic Load Balancing                                                                                                                                                                                                                                                                |
| 설명      | 확장성, 성능, 보안성을 통한 애플리케이션 내결함성을 제공하는 로드 밸런서                                                                                                                                                                                                                     |
| 주요 특징 | - 수신되는  트래픽을 여러 EC2 인스턴스에 자동 배포<br>- 애플리케이션의 내결함성을 확보하며, 네트워크 트래픽을 원활하게 대상으로 자동 분산 처리 기능 제공<br>- 고가용성, 자동 조정 및 강력한 보안 서비스 제공<br>- 4가지 유형의 로드 밸런서를 지원하며, 애플리케이션의 필요에 따라 로드밸런싱 |
| 프리티어  | - 클래식 및 애플리케이션 로드 밸런서 간에 공유되는 탄력적 로드 밸런서 750시간을 프리티어로 제공<br>- 클래식 로드 밸런서의 데이터 처리 15GB, 애플리케이션 로드 밸런서 15GB를 프리티어로 제공                                                                                                                                                                                                                                                                                             |

# ELB 종류 및 유형

| 구분                      | 내용                                                                                                                                                                                                                                      | 적합 서비스                              |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| Application Load Balancer | - OSI 모델 7계층에서 작동하며, HTTP, HTTPS와 같은 고급 로드 밸런싱 서비스에 적합<br>- 마이크로 서비스 및 컨테이너 기반 애플리케이션, 최신 애플리케이션 서비스에 최적화된 로드밸런싱 제공, SSL/TLS 암호화 및 프로토콜 사용하여 보안성 보장 | HTTP/HTTPS 서비스                        |
| Network Load Balancer     | - OSI 모델 4계층에서 작동하며, TCP 트래픽의 로드 밸런싱 서비스에 적합<br>- 짧은 지연 시간과 초당 수백만 개의 요청 처리가 가능하며, 가용 영역당 1개의 정적 주소를 사용하면서 트래픽의 변동이 심한 서비스에 최적화                          | TCP 트래픽 로드 밸런싱 및 짧은 지연 시간 |
| Classic Load Balancer     | - OSI 모델 4계층, 7계층에서 작동                                                                                                                                                                                                          |                                          |
| Gateway Load Balancer     | - 3계층 게이트웨이 + 4 계층 로드 밸런싱                                                                                                                                                                                                                                          |                                          |

로드 밸런싱 서비스를 인터넷에 연결할 것인지 아닌지에 따라 Internet facing 여부를 선택

| 항목           | External ELB          | Internal ELB |
| -------------- | --------------------- | ------------ |
| 인터넷 연결    | 연결 가능             | 연결 불가    |
| 사용 가능 IP   | Public IP, Private IP | Private IP   |
| 접속 가능 영역 | 인터넷, VPC 내부      | VPC 내부     | 

# 주요 특징
## Health Check
- 인스턴스의 OS나 애플리케이션의 문제로 인해 연결 장애나 서비스 가능 여부에 대한 Health Check를 지속적으로 수행
- Health check 가 실패하는 경우 해당 인스턴스로 트래픽 전달하지 않음
- HTTP와 HTTPS 상태 확인 빈도, 실패 임계치 ,성공 시 응답 코드를 임의 설정 가능
- 자세한 상태 확인과 실패원인은 API를 통해 확인 가능, AWS 콘솔에도 표시된다.
- TCP 방식으로 수행하는 경우 서비스 Port의 오픈 여부 및 연결 가능 여부 확인. HTTP나 HTTPS 방식으로 수행하는 경우 특정 웹 페이지 접속 시도에 따른 응답 코드(200)의 정상 반환 여부 확인
## Sticky Session
- 기본적으로 Round Robin 방식을 사용하기 때문에 한 번 연결된 Session이 그대로 연결되지 않는다.
- sticky session을 사용하면 처음 연결된 Client에 별도의 HTTP 기반의 쿠키 값을 생성하여 다음번 연결 요청에 대해 처음 접속했던 서버로 연결하도록 트래픽 처리
## 고가용성 구성
- 단일 AZ 또는 여러 AZ에 있는 여러 대상에 걸쳐 트래픽을 분산
- 고가용성을 위해 Route53와 같은 AWS의 다른 서비스와의 연계를 통해 고가용성 서비스를 제공
## SSL Termination 및 보안 기능
- SST Termination을 사용하면 개별 인스턴스에 SSl 인증서를 직접 설치할 필요 없다.
- ELB에 공인 인증서 또는 ACM(Amazon Certificate Manager)에서 무료로 발급 받을 수 있는 사설 인증서를 등록함으로써 HTTPS 활용 트래픽 암호화 및 복호화 서비스를 제공 가능
- ACM을 사용하는 경우  추가적인 인증서 발급 비용은 무료이며 별도의 인증서 관리도 필요하지 않다. 인스턴스의 암호화 및 복호화에 따른 부하도 줄일 수  있다.

# 실습
1. EC2에서 대상 그룹 생성
2. 대상 그룹에 target이 될 인스턴스들 추가
3. 로드밸런서에서 로드밸런서 추가

## sticky session 활성화
1. 로드밸런싱 -> 대상 그룹
2. 대상 그룹 선택 -> attribute
3. sticky session 활성화 및 연결 시간 설정