 # 네트워크 계층의 역할과 IP의 구조

## 네트워크 계층
- OSI 7 Layer의 3계층으로 패킷 포워딩과 네트워크간 라우터를 통한 라우팅 수행
- IP(Internet Protocol)주소를 사용하여 통신, 계층적 구조라고 한다.
- 대표적인 장비로는 라우터가 있고 L3기능이 있는 스위치라고도 한다. 요즘은 방화벽에도 라우팅 기능이 있기도 하다. 상위계층에서 라우팅을 처리하기도함.
![](images/Pasted%20image%2020221117135037.png)

## IP 정의와 구조
### IP(Internet Protocol)
- 네트워크 계층에서 통신하는 주요 프로토콜로 라우팅을 구현하고 본질적인 인터넷을 구축하는 계기가 됨
- 1974년 IEEE 논문 발표 "A Protocol for Packet Network Intercommunication"
- 전송 제어 프로그램의 비연결 테이터그램 서비스로 시작, 이후 해당 부분이 연결 지향 서비스로 보완이 됨
- RFC 760 -> RFC 791 IP, Connectionless(패킷 베이스)
- RFC 761 -> RFC 793 TCP, Connection-oriented service(포트 베이스, 통로)
- TCP/IP 모델의 기원
- 현재 사용중인 버전은 IPv4이며 후속 버전으로 IPv6릴리즈

### IP 주소 확인
- ifconfig로 확인

### IP 구조
- IP는 헤더와 페이로드로 구성되어 있다.
- 헤더는 목적지 & 출발지 IP 주소 등을 포함, 페이로드는 전송되는 데이터를 의미(상위 정보를 포함한다. 예를 들어 TCP, UDP)
![](images/Pasted%20image%2020221117135939.png)

### IPv4 헤더 구조
- 최소 20바이트(옵션 미 지정시), 8비트 -> 1바이트, 5x4 바이트
![](images/Pasted%20image%2020221117135958.png)
- version: IP 버전, IPv4
- Header Length(HLEN): 헤더의 길이. 4바이트 단위 최소 5(한 줄 당 1, 최소 20 바이트, 최대 15줄)
- Type of Service: 서비스 품질
- Total Packet Length: IP 패킷 전체의 길이 - 바이트 단위 - 최대 65535
- Identifier, Flags, Offset: IP Fragment(IP통신의 기본 펑션) 필드로 단편화와 재조합, 큰 패킷을 작은 패킷으로 나누어 전송하는 경우
- Time to Live: IP 패킷 수명
	- IP는 통신을 하기 위해 출발지부터 목적지 까지 수많은 라우터를 거쳐가야 한다. 보통 64나 128로 세팅 되어 있다. 세팅되어 있지 않은 경우에 잘못된 IP나 경로가 없는 것들은 계속 루프를 돌 수 있다. 
- Protocol ID: 데이터에 포함되어 있는 상위 계층의 프로토콜 정보, TCP 5, UDP 17
- Header Checksum: 오류 검출
- Source, Destination IP Address: 출발지 & 목적지 주소
- IP Header Options & Padding: 옵션, 거의 사용되지 않음/ 디버깅 용도, 통신에는 미관여

### IPv4 헤더 구조 - PCAP
![](images/Pasted%20image%2020221117143922.png)

## IP 주소 클래스

### IP 주소 구성
- IP주소는 2진수 31비트로 구성
	- 10101010.01101001.01010101.1001001
- 총 $2^{32}=4294967296=42억9천여개$
- 최초 IP주소 설계시 충분한 수량이었으나 현재는 거의 고갈된 상태
- 한국인터넷정보센터에서 IP 주소 할당 확인 가능
- 2진수는 어렵기 때문에 일반적으로 10진수로 표현
	- 168.126.63.1
	- $2^8 = 256$ 10진수 한 옥텟은 0 ~ 255 까지 가능

### 네트워크와 호스트
- IP 주소는 네트워크 부분과 호스트 부분으로 나뉜다.
- 네트워크는 브로드캐스트 영역(네트워크 안에서는 PC끼리 통신이 가능하다. 이외의 IP끼리는 라우팅이 필요하다.), 호스트는 개별 단말기
	- 192.268.1.0~255 -> 198.168.1 부분 : 네트워크 / 0~255 부분 : 호스트
![image|center|200](images/1.png)
예를 들어 경기도는 수원, 안양, 용인시로 구성되었다고 가정하면, 
- 같은 수원시에 사는 철수와 민수는 시내버스를 타고 만난다.
- 안양시에 사는 영희를 만나기에 위해서는 시외버를 타야한다.
- 수원, 안양, 용인 = 네트워크 = 라우터
- 철수, 민수, 영희 = 호스트 = PC
- 시내 = 브로드캐스트 스위칭, 시외 = 라우팅

### IP 주소 클래스
- IP주소는 네트워크의 크기에 따라 5개의 클래스(A, B, C, D, E)로 구분
- A클래스: 0.0.0.0 ~ 127.255.2255.255, 호스트는 $2^{24}$
![](images/Pasted%20image%2020221117153632.png)
- B클래스: 128.0.0.0.0 ~ 191.255.255.255, 호스트는 $2^{16}$
![](images/Pasted%20image%2020221117153652.png)
- C클래스: 192.0.0.0.0 ~ 223.255.255.255, 호스트는 $2^{8}$
![](images/Pasted%20image%2020221117153709.png)
- D클래스: 224.0.0.0.0 ~ 239.255.255.255, 멀티캐스트용
- E클래스: 224.0.0.0.0 ~ 255.255.255.254, 연구용

# 라우터와 서브넷팅

## 라우터의 이해
### 역할
- 목적지 IP 주소를 확인하고 하나 또는 그 이상의 네트워크 간의 패킷의 경로르 선택하여 전송
- Router: 네트워크 간의 패킷을 전송해주는 장비
- Routing: 네트워크 간의 패킷을 전달하는 경로를 선택하는 과정, Static & Dynamic
- Routed: 라우터가 라우팅을 해주는 대상, IP

### 인터페이스
- 라우터의 접속 가능한 포트로 통신용 & 관리용으로 구분
- 통신용은 UTP, 광, 무선으로 구성, WAN(Router to Router) 연결은 시리얼 포트도 존재
- 관리용은 보통 콘솔이라 부르며 원격에서 접속 불가 또는 장애시 장비에 직접 연결할 때 사용

## 서브넷 마스크
### 개념
- 서브넷: 부분망, IP주소는 네트워크와 호스트로 구분
- 할당된 네트워크 영역을 좀 더 효율적으로 사용하기 위해 서브넷으로 쪼개어 구성
- 네트워크를 여러개의 작은 네트워크로 구분하는 것을 서브넷 마스크라고 한다.
	- 총 C 클래스 254개의 IP 할당 211.109.131.0 ~ 255


## 라우터의 동작 방식
